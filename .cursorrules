# === INCIDENT BOT ‚Äî DEVELOPMENT RULES ===
# These rules define how the assistant (Claude / Cursor AI) should reason, generate, and structure code
# in the Incident Bot (Slack ‚Üî Notion integration) project.

project_name: Incident Bot
description: Slack + Notion integration for structured, blameless incident management at Appunite.

---

## üß≠ CONTEXT & PURPOSE
- This is an internal tool for Appunite.
- Core use case: reporting and managing service incidents via Slack ‚Üí stored in Notion.
- Notion is the **single source of truth** (no external DB).
- Slack is the **primary UX layer** (commands, modals, threads, notifications).
- Tone of bot messages: neutral, factual, human (no emojis unless for structure).

---

## üìÇ PROJECT STRUCTURE
- All code lives under `/src/`
- Folders:
  - `/src/slack` ‚Üí Slack app handlers (commands, modals, events)
  - `/src/notion` ‚Üí Notion API helpers
  - `/src/utils` ‚Üí utilities and logging
  - `/src/app.ts` ‚Üí Slack Bolt app initialization
  - `/src/server.ts` ‚Üí express server wrapper

Never flatten this structure unless explicitly asked.

---

## üß± TECHNOLOGY RULES
- Language: TypeScript (strict mode ON)
- Runtime: Node.js 18+
- Frameworks:
  - Slack Bolt SDK (`@slack/bolt`)
  - Notion SDK (`@notionhq/client`)
  - Express for healthcheck endpoint
- No ORM, no local DB (Notion = storage)
- All secrets must come from `.env` via `process.env`

---

## üß∞ IMPLEMENTATION GUIDELINES
- Each Slack command handler lives in its own file under `/src/slack/commands/`.
- Each modal submission handler lives under `/src/slack/modals/`.
- Use clear function names:
  - `registerIncidentCommand(app)`
  - `handleIncidentModalSubmission(app)`
- Keep responses short and structured (‚â§ 500 chars per Slack message).
- Prefer `async/await`, never `.then()` chains.
- Catch and log all errors (use `logger.ts`).

---

## üß† BUSINESS LOGIC RULES
- When user triggers `/incident`, open a modal defined in `incidentModal.ts`
- Modal ‚Üí Title, Description, Severity, Area
- On submission ‚Üí call `createIncident()` from `/src/notion/createIncident.ts`
- Store:
  - Title
  - Description
  - Severity
  - Reporter
  - CreatedFrom = "Automatic"
  - SlackThreadID / SlackChannelID
- Post Slack confirmation message (in thread or DM).
- Daily job: summarize ‚Äúunassigned‚Äù incidents and post in channel `#incident-digest`.
- Postmortem reminder after 24h of ‚ÄúResolved‚Äù.

---

## üîÅ SYNC RULES
- Sync direction: Notion ‚Üí Slack every 5 min.
- Compare `last_edited_time` from Notion.
- If `Status` or `Owner` changed ‚Üí post update to Slack thread.
- Keep cache of `lastSynced` timestamps in memory (or local JSON file).
- Never overwrite Notion content from Slack unless explicit command.

---

## üß© CODE STYLE
- ESLint: recommended rules (no console.log in production)
- Comments: English, concise
- Commit messages: Conventional Commits (e.g. `feat: add incident modal handler`)
- Function names: descriptive, camelCase
- Files: kebab-case (e.g. `create-incident.ts`)
- Exports: default for main handlers, named for utilities

---

## üß± DOCUMENTATION
- Always update `/docs/` if implementation deviates from design.
- Link relevant sections in PR descriptions (e.g. ‚ÄúImplements section 3.2 of INCIDENT_FLOW.md‚Äù).

---

## üß© COMMUNICATION STYLE (for Claude or Cursor AI)
When planning tasks:
- Reference `/docs/PROJECT_OVERVIEW.md` for business intent
- Reference `/docs/INCIDENT_FLOW.md` for behavior
- Reference `/docs/API_REFERENCE.md` for method definitions
When uncertain, ask clarifying questions before coding.
When generating code, include:
- Inline comments for reasoning
- Example logs for debugging
- Minimal output to Slack

---

## üß© TESTING
- Local tests: use mock Notion responses and Slack payload samples.
- Don‚Äôt mock with Jest ‚Äî use inline fixtures in `/src/tests/fixtures/`.
- Include at least one `test-incident.json` file for integration simulation.

---

## ü™Ñ AI-SPECIFIC RULES
- Claude/Cursor must **not hallucinate API endpoints**.
- Always use real Slack + Notion SDK syntax.
- Respect file structure and naming ‚Äî create missing files when needed.
- Always import from relative paths (`../notion/client` etc.)
- After implementing new feature, generate or update docs in `/docs/`.

---

# ‚úÖ END OF RULES
